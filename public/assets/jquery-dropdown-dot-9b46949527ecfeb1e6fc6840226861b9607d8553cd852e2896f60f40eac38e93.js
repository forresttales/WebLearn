!function(e){e.fn.dropdown=function(t){var s=e.extend({selected:".selected",items:"ul",item:"li",openClass:"open",changed:function(){}},t);return this.each(function(){function t(t,n){var a=e(t);u.find(s.item).removeClass("hover"),a.addClass("hover"),n&&a.parent().scrollTop(a.position().top-a.height())}function n(t){var n=e(t).data("index"),a=c.items[n];f.find("> "+s.selected).html(o(a)),u.find("[data-index="+r+"]").removeClass("selected"),r=n,e(t).addClass("selected"),d.val(a.value),s.changed(a),i()}function a(){u.show(),f.addClass(s.openClass)}function i(){u.hide(),f.removeClass(s.openClass)}var d=e(this);d.hide();var l=doT.template(e(d.data("template")).text()),o=doT.template(e(d.data("template")+"-selected").text()),c={selected:null,items:[],classes:d.data("classes")},r=0;e.each(d.find("option"),function(t,s){var n=e(s),a={value:n.attr("value"),label:n.text(),selected:n.is(":selected"),select_id:d.attr("id")},i=n.data();e.each(i,function(e,t){a[e]=t}),n.is(":selected")&&(c.selected=a,r=t),c.items.push(a)});var f=e(l(c)),u=f.find(s.items),v=f.find("> "+s.selected);return v.on("mousedown",function(){return f.focus(),u.is(":visible")?i():a(),!1}),f.on("focus",function(){d.addClass("focus")}),f.on("blur",function(){d.removeClass("focus"),i()}),f.on("keydown",function(e){var i=null;switch(e.keyCode){case 40:f.hasClass(s.openClass)?(i=u.find(".hover").next(s.item).first(),i.length||(i=u.find(s.item).first())):(a(),i=u.find(".selected")),t(i,!0),e.preventDefault();break;case 38:f.hasClass(s.openClass)?(i=u.find(".hover").prev(s.item).first(),i.length||(i=u.find(s.item).last())):(a(),i=u.find(".selected")),t(i,!0),e.preventDefault();break;case 13:if(f.hasClass(s.openClass)){var d=u.find(".hover").first();d&&n(d)}else a();e.preventDefault()}}),u.find("[data-index="+r+"]").addClass("selected"),u.on("mousedown",s.item,function(){return n(this),!1}),u.on("mouseover",s.item,function(){t(this,!1)}),d.before(f)})}}(jQuery);